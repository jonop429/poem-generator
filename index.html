<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paradelle Generator</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
    }
    input {
      display: block;
      width: 100%;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
    }
    button {
      margin-left: 0rem;
      margin-right: 0.25rem;
      margin-top: 0.25rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background-color: #222;
      color:#fff;
      border: 0;
      border-radius: 5px;
      cursor: pointer;
    }
    .word {
      display: inline-block;
      margin: 2px;
      padding: 4px 6px;
      background: #f0f0f0;
      border: 1px solid #ccc;
      cursor: move;
      user-select: none;
    }
    .line {
      margin-bottom: 0.5rem;
    }
    .poem {
      background: #f9f9f9;
      padding: 1rem;
      border: 1px solid #ccc;
      margin-top: 1rem;
      white-space: pre-wrap;
      min-height: 300px;
    }
    .info-container {
      position: relative;
      display: inline-block;
      cursor: pointer;
      margin-left: 0.5rem;
      color: #555;
      font-size: 18px;
      vertical-align: middle;
    }
    .tooltip {
      visibility: hidden;
      opacity: 0;
      width: 220px;
      background-color: #333;
      color: #fff;
      text-align: left;
      border-radius: 5px;
      padding: 0.5rem;
      position: absolute;
      top: 1.5rem;
      left: 0;
      z-index: 10;
      transition: opacity 0.3s;
      font-size: 0.9rem;
    }
    .info-container:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
    .controls {
      margin-top: 1rem;
    }
    .controls button {
      margin-right: 0.5rem;
    }
    .credits {
      margin-top: 2rem;
      margin-left: 1rem;
      font-size: 0.85rem;
      color: #666;
      border-top: 1px solid #ccc;
      padding-top: 1rem;
      text-align: center;
    }
    .credits a {
      color: #666;
    }
    .credits a:hover {
      color: #555;
    }

    #menu {
    position: fixed;
    top: 1rem;
    left: 1rem;
    font-size: 1.5rem;
    cursor: pointer;
    z-index: 100;
    }

    #menu-content {
    display: none;
    margin-top: 0.5rem;
    background: #f9f9f9;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 0.25rem 0;
    font-size: 1rem;
    }

    #menu:hover #menu-content {
    display: block;
    }

    .menu-item {
    padding: 0.4rem 0.75rem;
    cursor: pointer;
    white-space: nowrap;
    }

    .menu-item:hover {
    background: #eee;
    }

    .input-row {
    display: flex;
    align-items: center;
    margin-bottom: 0.5rem;
    }

    .drag-handle {
    cursor: move;
    margin-right: 0.5rem;
    color: #888;
    user-select: none;
    font-size: 1.1rem;
    }

    .input-row input {
    flex: 1;
    }

  </style>
</head>
<body>
    <div id="menu">
    ☰
    <div id="menu-content">
        <div class="menu-item" data-form="paradelle">Paradelle</div>
        <div class="menu-item" data-form="newform">Obverse</div>
    </div>
    </div>
  
    <h1 id="form-title"></h1>

  <div id="input-section"></div>

  <div id="output-section" style="display:none;">
    <div class="poem" id="poem"></div>
    <div class="controls">
      <button id="backBtn">Back to form</button>
      <button id="shuffleBtn">Shuffle</button>
      <button id="togglePlainBtn">View as Plain Text</button>
    </div>
  </div>

  <div class="credits">
    Built by <a href="https://chat.openai.com">ChatGPT</a> and a human collaborator
  </div>

  <script>

    /* -----------------------------
    STATE
    ----------------------------- */

    let currentForm = "paradelle";
    let isReverseMode = false;

    let inputLines = Array(6).fill("");
    let obverseInputs = Array(4).fill("");
    let thesisQuestion = "";

    /* -----------------------------
    CORE GENERATORS
    ----------------------------- */

    const handleGenerateParadelle = (reverse) => {
    isReverseMode = reverse;
    inputSection.style.display = "none";
    outputSection.style.display = "block";
    renderParadelle();
    };

    const handleGenerateObverse = (reverse) => {
    isReverseMode = reverse;
    inputSection.style.display = "none";
    outputSection.style.display = "block";
    renderObverse();
    };

    /* -----------------------------
    FORM REGISTRY
    ----------------------------- */

    const forms = {
    paradelle: {
        title: "Paradelle Generator",
        info: "A constrained poem built from repeating and recombining lines.",
        generate: handleGenerateParadelle
    },
    obverse: {
        title: "Obverse",
        info: "Inputs are mirrored to form two stanzas, followed by a thesis question.",
        generate: handleGenerateObverse
    }
    };

    /* -----------------------------
    INPUT RENDERERS
    ----------------------------- */

    const generateInputs = () => {
    inputSection.innerHTML = "";

    const container = document.createElement("div");
    inputSection.appendChild(container);

    renderDraggableInputs(container, inputLines, "Enter line");

    const btn = document.createElement("button");
    btn.textContent = "Generate";
    btn.onclick = () => forms[currentForm].generate(false);

    const btnReverse = document.createElement("button");
    btnReverse.textContent = "Generate (Reverse)";
    btnReverse.onclick = () => forms[currentForm].generate(true);

    inputSection.append(btn, btnReverse);
    };

    const generateObverseInputs = () => {
    inputSection.innerHTML = "";

    const container = document.createElement("div");
    inputSection.appendChild(container);

    renderDraggableInputs(container, obverseInputs, "Input");

    const addBtn = document.createElement("button");
    addBtn.textContent = "Add input";
    addBtn.onclick = () => {
        obverseInputs.push("");
        generateObverseInputs();
    };

    const thesisWrap = document.createElement("div");
    thesisWrap.style.marginTop = "1rem";

    const thesisInput = document.createElement("input");
    thesisInput.placeholder = "Thesis question";
    thesisInput.value = thesisQuestion;
    thesisInput.oninput = e => thesisQuestion = e.target.value;

    const questionMark = document.createElement("span");
    questionMark.textContent = " ?";
    questionMark.style.marginLeft = "0.25rem";

    thesisWrap.append(thesisInput, questionMark);

    const btn = document.createElement("button");
    btn.textContent = "Generate";
    btn.onclick = () => forms[currentForm].generate(false);

    const btnReverse = document.createElement("button");
    btnReverse.textContent = "Generate (Reverse)";
    btnReverse.onclick = () => forms[currentForm].generate(true);

    inputSection.append(addBtn, thesisWrap, btn, btnReverse);
    };

    /* -----------------------------
    DRAGGABLE INPUT HELPER
    ----------------------------- */

    const renderDraggableInputs = (container, values, label) => {
    container.innerHTML = "";

    values.forEach((value, index) => {
        const row = document.createElement("div");
        row.className = "input-row";
        row.draggable = true;

        const handle = document.createElement("span");
        handle.className = "drag-handle";
        handle.textContent = "≡";

        const input = document.createElement("input");
        input.placeholder = `${label} ${index + 1}`;
        input.value = value;
        input.oninput = e => values[index] = e.target.value;

        row.ondragstart = e => {
        e.dataTransfer.setData("text/plain", index);
        row.style.opacity = "0.5";
        };

        row.ondragend = () => row.style.opacity = "1";

        row.ondragover = e => e.preventDefault();

        row.ondrop = e => {
        e.preventDefault();
        const from = +e.dataTransfer.getData("text/plain");
        const to = index;
        if (from === to) return;
        const moved = values.splice(from, 1)[0];
        values.splice(to, 0, moved);
        renderDraggableInputs(container, values, label);
        };

        row.append(handle, input);
        container.appendChild(row);
    });
    };

    /* -----------------------------
    OUTPUT RENDERERS
    ----------------------------- */

    const renderParadelle = () => {
    outputSection.textContent = isReverseMode
        ? "Paradelle (reverse mode)"
        : "Paradelle (forward mode)";
    };

    const renderObverse = () => {
    const lines = obverseInputs.filter(l => l.trim());
    const reversed = [...lines].reverse();

    outputSection.innerHTML = "";

    const stanza1 = document.createElement("div");
    const stanza2 = document.createElement("div");

    const first = isReverseMode ? reversed : lines;
    const second = isReverseMode ? lines : reversed;

    first.forEach(l => stanza1.append(l, document.createElement("br")));
    second.forEach(l => stanza2.append(l, document.createElement("br")));

    const thesis = document.createElement("div");
    thesis.style.marginTop = "1rem";
    thesis.textContent = thesisQuestion.trim().endsWith("?")
        ? thesisQuestion.trim()
        : thesisQuestion.trim() + "?";

    outputSection.append(stanza1, stanza2, thesis);
    };

    /* -----------------------------
    TITLE + MENU
    ----------------------------- */

    const renderTitle = () => {
    title.textContent = forms[currentForm].title;
    info.textContent = forms[currentForm].info;
    };

    document.querySelectorAll(".menu-item").forEach(item => {
    item.onclick = () => {
        currentForm = item.dataset.form;
        outputSection.style.display = "none";
        inputSection.style.display = "block";
        renderTitle();

        currentForm === "obverse"
        ? generateObverseInputs()
        : generateInputs();
    };
    });

    /* -----------------------------
    INITIAL LOAD
    ----------------------------- */

    renderTitle();
    generateInputs();


  </script>
</body>
</html>